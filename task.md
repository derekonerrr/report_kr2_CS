# Контрольная работа №2
*Студент: Шемякин М.А. Группа: УИБО-05-24*
# Задание 1. SQL-injection и логин с административными правами

# Задание 2. Ответы на теоретические вопросы

### Что такое SQL-инъекция?

**SQL-инъекция (SQL Injection, SQLi)** — это тип уязвимости, который возникает, когда злоумышленник может внедрить (инъецировать) вредоносный SQL-код в запросы, выполняемые веб-приложением к базе данных.

Это происходит, когда приложение использует **непроверенные** или **неэкранированные** данные, предоставленные пользователем (например, из полей ввода на сайте), в качестве части SQL-запроса. Если злоумышленник вводит специальную строку, она может изменить логику исходного запроса, позволяя ему выполнять несанкционированные действия, такие как просмотр, изменение или удаление данных. 


### Почему ввод строки ' or 1=1;-- позволил войти в аккаунт администратора?

Этот конкретный ввод часто используется для обхода аутентификации. Разберём его по частям в контексте типового SQL-запроса для входа в систему:

1.  **Типичный запрос (до инъекции):**
    Предположим, приложение генерирует запрос, подобный этому:
    
    `SELECT * FROM users WHERE username = 'Введенный_Логин' AND password = 'Введенный_Пароль';`

2.  **Запрос с инъекцией:**
    Если в поле логина ввести `admin' or 1=1;--`, а в поле пароля что угодно, запрос может стать таким:

    `SELECT * FROM users WHERE username = 'admin' or 1=1;--' AND password = 'Любой_Пароль';`

3.  **Разбор инъекции:**

    * **`'` (Одинарная кавычка):** Закрывает кавычку, открытую в запросе для значения `username`. Теперь остальная часть инъекции воспринимается как часть SQL-кода, а не как строковое значение.
    * **`or 1=1`:** Добавляет логическое условие `OR 1=1`. Поскольку `1=1` всегда истинно (TRUE), всё условие `WHERE` становится истинным для *первой же записи*. В большинстве систем это будет запись администратора или просто первая запись в таблице пользователей, что позволяет пройти проверку подлинности, не зная пароля.
    * **`;--` (Точка с запятой и двойной дефис):** Точка с запятой `;` завершает текущую команду. Двойной дефис `--` (или `#` в MySQL) является символом комментария, который заставляет СУБД игнорировать всё, что следует после него, включая оставшуюся часть исходного запроса (например, часть `AND password = '...'`).

    Таким образом, запрос фактически превращается в: "Выбрать всех пользователей, где логин равен 'admin', **ИЛИ** где 1=1 (что всегда истинно)". Это позволяет войти в систему под первым найденным пользователем.


### Как защитить web-ресурс от подобного рода атак?

Самые эффективные методы защиты сосредоточены на разделении данных, вводимых пользователем, от исполняемого SQL-кода.

#### 1. Использование Подготовленных Выражений (Prepared Statements)

Это **наиболее эффективный** метод.

* **Суть:** Запрос SQL определяется заранее с использованием **плейсхолдеров** (например, `?` или `:name`) вместо фактических значений. Пользовательский ввод передаётся базе данных **отдельно** и всегда обрабатывается как **данные**, а не как часть исполняемого кода.
* **Пример:**
    * Вместо: `query = "SELECT * FROM users WHERE username = '" + user_input + "';"`
    * Используется: `query = "SELECT * FROM users WHERE username = ?;"` (а затем `user_input` безопасно привязывается к `?`).

#### 2. Экранирование Ввода (Escaping User Input)

* **Суть:** Все потенциально опасные символы (такие как одинарные кавычки `'`, двойные кавычки `"` , обратные слэши `\` и т.д.) преобразуются в их безопасные экранированные эквиваленты.
* **Пример:** Одинарная кавычка `'` преобразуется в `\'` или `''`.
* **Примечание:** Этот метод считается менее надёжным, чем Prepared Statements, и его лучше использовать как дополнительную меру.

#### 3. Принцип Минимальных Привилегий

* **Суть:** Аккаунт, который веб-приложение использует для подключения к базе данных, должен иметь **минимально необходимые права**.
* **Пример:** Учётная запись, используемая веб-сайтом, не должна иметь прав на удаление таблиц (`DROP TABLE`), доступ к системным настройкам или доступ к базам данных, не связанным с этим веб-ресурсом. Если инъекция произойдёт, ущерб будет ограничен.

#### 4. Проверка и Валидация Ввода (Input Validation)

* **Суть:** Перед использованием любых данных, введённых пользователем, следует проверять, соответствуют ли они ожидаемому формату.
* **Пример:**
    * Поле **`user_id`** должно содержать только целые числа. Отклонять любой ввод, содержащий буквы или символы.
    * Поле **`username`** не должно превышать 50 символов и может содержать только буквы и цифры.
