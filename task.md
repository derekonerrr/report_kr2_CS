# Контрольная работа №2
*Студент: Шемякин М.А. Группа: УИБО-05-24*
# Задание 1. SQL-injection и логин с административными правами

<img width="446" height="782" alt="Снимок экрана 2025-11-26 в 17 36 52" src="https://github.com/user-attachments/assets/19d96624-1c2b-436d-a1c9-f7e1c2a85c87" />

Это означает что база данных пользователей реализована с уязвимостями

Ввод ' or 1=1;-- в поле логин и случаного пароля позволили залогиниться по пользователем admin@juice-sh.op. Предположим, что это администратор. 

<img width="1245" height="368" alt="Снимок экрана 2025-11-26 в 17 38 13" src="https://github.com/user-attachments/assets/5e535026-061a-48ae-85ab-d584c9edd744" />


# Ответы на теоретические вопросы

### Что такое SQL-инъекция?

**SQL-инъекция (SQL Injection, SQLi)** — это тип уязвимости, который возникает, когда злоумышленник может внедрить (инъецировать) вредоносный SQL-код в запросы, выполняемые веб-приложением к базе данных.

Это происходит, когда приложение использует **непроверенные** или **неэкранированные** данные, предоставленные пользователем (например, из полей ввода на сайте), в качестве части SQL-запроса. Если злоумышленник вводит специальную строку, она может изменить логику исходного запроса, позволяя ему выполнять несанкционированные действия, такие как просмотр, изменение или удаление данных. 


### Почему ввод строки ' or 1=1;-- позволил войти в аккаунт администратора?

Этот конкретный ввод часто используется для обхода аутентификации. Разберём его по частям в контексте типового SQL-запроса для входа в систему:

1.  **Типичный запрос (до инъекции):**
    Предположим, приложение генерирует запрос, подобный этому:
    
    `SELECT * FROM users WHERE username = 'Введенный_Логин' AND password = 'Введенный_Пароль';`

2.  **Запрос с инъекцией:**
    Если в поле логина ввести `admin' or 1=1;--`, а в поле пароля что угодно, запрос может стать таким:

    `SELECT * FROM users WHERE username = 'admin' or 1=1;--' AND password = 'Любой_Пароль';`

3.  **Разбор инъекции:**

    * **`'` (Одинарная кавычка):** Закрывает кавычку, открытую в запросе для значения `username`. Теперь остальная часть инъекции воспринимается как часть SQL-кода, а не как строковое значение.
    * **`or 1=1`:** Добавляет логическое условие `OR 1=1`. Поскольку `1=1` всегда истинно (TRUE), всё условие `WHERE` становится истинным для *первой же записи*. В большинстве систем это будет запись администратора или просто первая запись в таблице пользователей, что позволяет пройти проверку подлинности, не зная пароля.
    * **`;--` (Точка с запятой и двойной дефис):** Точка с запятой `;` завершает текущую команду. Двойной дефис `--` (или `#` в MySQL) является символом комментария, который заставляет СУБД игнорировать всё, что следует после него, включая оставшуюся часть исходного запроса (например, часть `AND password = '...'`).

    Таким образом, запрос фактически превращается в: "Выбрать всех пользователей, где логин равен 'admin', **ИЛИ** где 1=1 (что всегда истинно)". Это позволяет войти в систему под первым найденным пользователем.


### Как защитить web-ресурс от подобного рода атак?

Самые эффективные методы защиты сосредоточены на разделении данных, вводимых пользователем, от исполняемого SQL-кода.

#### 1. Использование Подготовленных Выражений (Prepared Statements)

Это **наиболее эффективный** метод.

* **Суть:** Запрос SQL определяется заранее с использованием **плейсхолдеров** (например, `?` или `:name`) вместо фактических значений. Пользовательский ввод передаётся базе данных **отдельно** и всегда обрабатывается как **данные**, а не как часть исполняемого кода.
* **Пример:**
    * Вместо: `query = "SELECT * FROM users WHERE username = '" + user_input + "';"`
    * Используется: `query = "SELECT * FROM users WHERE username = ?;"` (а затем `user_input` безопасно привязывается к `?`).

#### 2. Экранирование Ввода (Escaping User Input)

* **Суть:** Все потенциально опасные символы (такие как одинарные кавычки `'`, двойные кавычки `"` , обратные слэши `\` и т.д.) преобразуются в их безопасные экранированные эквиваленты.
* **Пример:** Одинарная кавычка `'` преобразуется в `\'` или `''`.
* **Примечание:** Этот метод считается менее надёжным, чем Prepared Statements, и его лучше использовать как дополнительную меру.

#### 3. Принцип Минимальных Привилегий

* **Суть:** Аккаунт, который веб-приложение использует для подключения к базе данных, должен иметь **минимально необходимые права**.
* **Пример:** Учётная запись, используемая веб-сайтом, не должна иметь прав на удаление таблиц (`DROP TABLE`), доступ к системным настройкам или доступ к базам данных, не связанным с этим веб-ресурсом. Если инъекция произойдёт, ущерб будет ограничен.

#### 4. Проверка и Валидация Ввода (Input Validation)

* **Суть:** Перед использованием любых данных, введённых пользователем, следует проверять, соответствуют ли они ожидаемому формату.
* **Пример:**
    * Поле **`user_id`** должно содержать только целые числа. Отклонять любой ввод, содержащий буквы или символы.
    * Поле **`username`** не должно превышать 50 символов и может содержать только буквы и цифры.
 
# Задание №2. Узнать пароль администратора 

<img width="1384" height="804" alt="Снимок экрана 2025-11-29 в 15 16 56" src="https://github.com/user-attachments/assets/7a13a886-3792-42ef-b7ab-343ff71cebf3" />

<img width="714" height="538" alt="Снимок экрана 2025-11-29 в 15 16 44" src="https://github.com/user-attachments/assets/c07bcd22-3d6f-428b-92f6-91b1aa92b408" />


status: статус операции — «успешно».
data: объект с данными пользователя:
id: 1 (идентификатор пользователя).
email: admin@juice-sh.op (почта администратора).
role: admin (роль — администратор).
isActive: true (аккаунт активен).
createdAt/updatedAt: дата создания/обновления аккаунта.
iat (issued at): время выдачи токена в формате Unix‑времени. Хэш "password": "0192023a7bbd73250516f069df18b500". Атака на него даже с помощью онлайн крэкера позволяет узнать строку пароля - admin123:


<img width="1029" height="343" alt="Снимок экрана 2025-11-29 в 15 36 53" src="https://github.com/user-attachments/assets/6c10add1-d05b-469a-a83d-8246082fdfb3" />

<img width="869" height="629" alt="Снимок экрана 2025-11-29 в 15 20 52" src="https://github.com/user-attachments/assets/1859a176-b8d0-4c59-b45f-6a370a9f8441" />

<img width="422" height="301" alt="Снимок экрана 2025-11-29 в 15 21 00" src="https://github.com/user-attachments/assets/e944c23e-e0dc-4be3-a228-84b33074b9eb" />

## Ответы на вопросы:
### Какой логин у админимтратора?
admin@juice-sh.op
### Хеш пароля администратора?
0192023a7bbd73250516f069df18b500
### Что такое куки?
Куки (HTTP-куки) — это небольшие текстовые файлы, которые веб-сайт отправляет в веб-браузер пользователя, и которые браузер сохраняет на устройстве.
Назначение
Основное назначение куки — поддержание состояния между клиентом (браузером) и сервером. Протокол HTTP является "без сохранения состояния" (stateless), и куки позволяют веб-сайтам:
Управлять сеансом: Сохранять аутентификационные данные пользователя, чтобы он оставался авторизованным при навигации между страницами.
Персонализировать: Запоминать настройки пользователя (язык, тема) и предпочтения.
Отслеживать: Собирать данные о поведении пользователя для аналитики и целевой рекламы.
### Какие меры могут быть использованы для устранения выявленной уязвимости?
Хранение хэша пароля (даже если он хэширован) в клиентском токене (JWT), который может быть легко декодирован, является серьезной утечкой информации и нарушает принцип наименьшей необходимости данных.

Рефакторинг JWT/Токенов Сеанса

Токены, передаваемые клиенту, должны содержать минимально необходимый набор данных для идентификации и авторизации пользователя.

Действие: Полностью удалить поле password (и его хэш) из полезной нагрузки JWT или любой другой структуры данных, отправляемой клиенту.

Оптимальный состав JWT: Токен должен содержать только id пользователя, role и время истечения (exp).

Использование Secure, HttpOnly Cookies

Для хранения самого JWT или токена сеанса необходимо использовать безопасные атрибуты куки:

HttpOnly: Предотвращает доступ к куки через клиентский JavaScript (document.cookie). Это критически важно для защиты от XSS-атак (даже если они не связаны с SQLi).

Secure: Гарантирует, что куки будут отправляться только по зашифрованному соединению HTTPS.

# Задание 3. Чужая корзина

<img width="1438" height="720" alt="Снимок экрана 2025-12-09 в 13 17 39" src="https://github.com/user-attachments/assets/584ea6cb-5598-4980-a744-3116042727a3" />


# Задание 4. XSS

Использовал данный [репозиторий](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection#xss-in-uppercase-output)
<img width="1326" height="655" alt="Снимок экрана 2025-12-03 в 18 38 40" src="https://github.com/user-attachments/assets/d551658b-f8e5-44ac-b0d8-abd7ca64da02" />


